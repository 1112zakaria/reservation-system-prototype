generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Resource {
  id          String   @id @default(cuid())
  name        String
  description String?
  slotMinutes Int      @default(30)
  capacity    Int      @default(1)

  rules        AvailabilityRule[]
  reservations Reservation[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AvailabilityRule {
  id         String   @id @default(cuid())
  resourceId String
  resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  weekday    Int
  startTime  String   // "09:00"
  endTime    String   // "17:00"
  isBlackout Boolean  @default(false)
  date       DateTime?

  createdAt  DateTime @default(now())
}

model Reservation {
  id            String   @id @default(cuid())
  resourceId    String
  resource      Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  startAt       DateTime
  endAt         DateTime
  status        ReservationStatus @default(BOOKED)

  customerName  String
  customerEmail String?
  notes         String?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([resourceId, startAt])
  @@unique([resourceId, startAt])
}

enum ReservationStatus {
  BOOKED
  CANCELLED
  NO_SHOW
}
